- name: Download and extract Elasticsearch
  unarchive:
    src: https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.5.0-linux-x86_64.tar.gz
    dest: /usr/local/bin
    remote_src: yes


- name: Configure Elasticsearch
  template:
    src: "elasticsearch.yml.j2"
    dest: /usr/local/bin/elasticsearch-7.5.0/config/elasticsearch.yml
    owner: root
    #group: elasticsearch
    mode: 0777


- name: Download and extract Kibana
  unarchive:
    src: https://artifacts.elastic.co/downloads/kibana/kibana-7.5.0-linux-x86_64.tar.gz
    dest: /usr/local/bin
    remote_src: yes

- name: Configure Kibana
  template:
    src: "kibana.yml.j2"
    dest: /usr/local/bin/kibana-7.5.0-linux-x86_64/config/kibana.yml
    owner: root
    mode: 0777

- name: Change ownership of Elasticsearch
  file:
    path: /usr/local/bin/elasticsearch-7.5.0
    state: directory
    recurse: yes
    owner: root
    #group: foo

- name: Change ownership of Kibana
  file:
    path: /usr/local/bin/kibana-7.5.0-linux-x86_64
    state: directory
    recurse: yes
    owner: root
    #group: foo

- name: Configs
  shell: sudo sysctl -w vm.max_map_count=262144
    
# - name: Start Elasticsearch
#   shell: /usr/local/bin/elasticsearch-7.5.0/bin/elasticsearch &

# - name: Start service foo
#   service:
#     name: "/usr/local/bin/elasticsearch-7.5.0/bin/elasticsearch"
#     state: started

# - name: Start Kibana
#   shell: /usr/local/bin/kibana-7.5.0/bin/kibana & # daemon -- 